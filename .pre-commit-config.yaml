---
# Pre-commit hooks for code quality and consistency
# See https://pre-commit.com for more information

repos:
  # ============================================================================
  # Ruff - Fast Python linting and formatting
  # Replaces: black, flake8, isort, pyupgrade, and many flake8 plugins
  # ============================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      # Run the linter with auto-fixes
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
        types_or: [python, pyi]
      # Run the formatter
      - id: ruff-format
        types_or: [python, pyi]

  # ============================================================================
  # Pre-commit hooks - General file checks
  # ============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # File size and permissions
      - id: check-added-large-files
        args: ["--maxkb=7000"]
        exclude: ^tests/data/
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

      # Syntax validation
      - id: check-toml
      - id: check-yaml
        args: [--allow-multiple-documents]
      - id: check-json
      - id: check-xml

      # Code quality
      - id: check-ast # Validate Python syntax
      - id: check-builtin-literals # Require literal syntax
      - id: check-case-conflict # Check for case-insensitive conflicts
      - id: check-docstring-first # Docstring should be first
      - id: check-merge-conflict # Check for merge conflict strings
      - id: debug-statements # Check for debugger imports
      - id: detect-private-key # Detect private keys

      # Formatting
      - id: end-of-file-fixer
        exclude: ^tests/data/
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
        exclude: ^tests/data/

      # Python-specific
      - id: fix-byte-order-marker # Remove UTF-8 BOM
      - id: fix-encoding-pragma # Remove # -*- coding: utf-8 -*-
        args: [--remove]
      - id: name-tests-test # Test files should match test_*.py
        args: [--pytest-test-first]
        exclude: ^tests/(support\.py|data/)

      # JSON/YAML formatting
      # Disabled: causes circular formatting issues
      # - id: pretty-format-json
      #   args: [--autofix, --no-sort-keys, --indent=2]
      #   exclude: ^tests/data/

  # ============================================================================
  # Type checking with mypy
  # ============================================================================
  # Temporarily disabled - types-all dependency issue
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.13.0
  #   hooks:
  #     - id: mypy
  #       additional_dependencies: [types-all]
  #       args: [--ignore-missing-imports, --show-error-codes]
  #       exclude: ^(tests/|docs/)

  # ============================================================================
  # Security checks
  # ============================================================================
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        args: [-c, pyproject.toml]
        additional_dependencies: ["bandit[toml]"]
        exclude: ^tests/

  # ============================================================================
  # Secrets detection
  # ============================================================================
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: [--baseline, .secrets.baseline]
        exclude: ^(tests/data/|poetry.lock)

  # ============================================================================
  # Documentation
  # ============================================================================
  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.10.0
    hooks:
      - id: python-check-blanket-noqa # Encourage specific noqa codes
      - id: python-check-blanket-type-ignore # Encourage specific type ignores
      - id: python-no-eval # No eval() usage
      - id: python-no-log-warn # Use .warning instead of .warn
      - id: python-use-type-annotations # Use annotations not comments
      - id: rst-backticks # RST code formatting
      - id: rst-directive-colons # RST directive formatting
      - id: rst-inline-touching-normal # RST inline code formatting
      - id: text-unicode-replacement-char # Check for unicode replacement char

  # ============================================================================
  # YAML/JSON/TOML linting
  # ============================================================================
  - repo: https://github.com/python-jsonschema/check-jsonschema
    rev: 0.29.4
    hooks:
      - id: check-github-workflows
        files: ^\.github/workflows/
      - id: check-readthedocs
        files: ^\.readthedocs\.yml$

  # ============================================================================
  # Markdown and general formatting
  # ============================================================================
  # Disabled: conflicts with pretty-format-json, causing circular formatting
  # - repo: https://github.com/pre-commit/mirrors-prettier
  #   rev: v3.1.0
  #   hooks:
  #     - id: prettier
  #       types_or: [yaml, markdown, json]
  #       exclude: ^(tests/data/)

  # ============================================================================
  # Notebook cleaning (if using Jupyter notebooks)
  # ============================================================================
  # Disabled: causes circular formatting issues with notebooks
  # - repo: https://github.com/kynan/nbstripout
  #   rev: 0.8.1
  #   hooks:
  #     - id: nbstripout
  #       args: [--extra-keys, metadata.kernelspec metadata.language_info.version]

  # ============================================================================
  # Spell checking
  # ============================================================================
  - repo: https://github.com/codespell-project/codespell
    rev: v2.3.0
    hooks:
      - id: codespell
        args: [--ignore-words-list=crate, nd, sav, ot]
        exclude: ^(tests/data/|.*\.lock|.*\.ipynb)

# Configuration
default_language_version:
  python: python3.13

# CI settings
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ""
  autoupdate_commit_msg: "[pre-commit.ci] pre-commit autoupdate"
  autoupdate_schedule: monthly
  skip: []
  submodules: false
